<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/termite-sq-48x48-wh.png">
    <link rel="preload" href="/assets/css/bootstrap.min.css" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/assets/css/bootstrap.min.css"></noscript>
    <link rel="preload" type="text/css" media="screen" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" type="text/css" media="screen" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}"></noscript>
    <script src="/assets/js/jquery-3.7.1.min.js" type="text/javascript"></script>
    <script src="/assets/js/parsley.min.js" type="text/javascript"></script>
    {% if page.how_to %}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": "{{ page.title }}",
        "description": "{{ page.description }}",
        "totalTime": "PT5S",
        "image": {
          "@type": "ImageObject",
          "url": "{{ site.url }}{{ page.how_to.form_image.link }}",
          "height": "{{ page.how_to.form_image.height }}",
          "width": "{{ page.how_to.form_image.width }}"
        },
        "step": [
          {
            "@type": "HowToStep",
            "name": "Enter Bank Details",
            "text": "{{ page.how_to.enter_bank_details }}"
          },
          {
            "@type": "HowToStep",
            "name": "Submit Form",
            "text": "Click the Generate button to submit bank-related information."
          },
          {
            "@type": "HowToStep",
            "name": "Receive A Valid {{ page.payment_field }}",
            "text": "Instantly receive a valid {{ page.payment_field }} generated by the system."
          }
        ],
        "tool": {
          "@type": "HowToTool",
          "name": "{{ page.title }}"
        }
      }
    </script>
    {% endif %}
    {% if page.faq_questions %}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {% for item in page.faq_questions %}
          {
            "@type": "Question",
            "name": "{{ item.question | escape }}",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "{{ item.answer | escape }}"
            }
          }{% if forloop.last == false %},{% endif %}
          {% endfor %}
        ]
      }
    </script>
    {% endif %}
    <script defer>
      $(function() {
        $("#api_form").parsley();

        $("#api_form").submit(function(e) {
          e.preventDefault();

          const api_payment_field = $(this).find('input[name="api_payment_field"]').val();
          const country_code = $(this).find('input[name="country_code"]').val();
          const non_param_fields = ["api_payment_field", "country_code", "payment_field"];

          let post_data = {
            country_code: country_code,
            payment_field: api_payment_field,
            params: {}
          };

          for (const element of $(this).serializeArray()) {
            if (!non_param_fields.includes(element.name)) {
              post_data.params[element.name] = element.value;
            }
          }

          $.ajax({
            type: "POST",
            url: "https://api.vigilandum.io/payment-field-engine",
            contentType: "application/json",
            crossDomain: true,
            data: JSON.stringify(post_data),
            dataType: "json",
            success: function(response) {
              const api_label = Object.keys(response)[0];
              const label = $('#api_form input[name="payment_field"]').val();
              const value = response[api_label];

              $("#result").removeClass("error").text(label + ":  " + value);
            },
            error: function(xhr, status, error) {
              let response_json;

              try {
                response_json = JSON.parse(xhr.responseText);
              } catch(e) {
                response_json = {};
              }
              const error_message = response_json.error || 'Unknown error';

              $("#result").addClass("error").text("Error:  " + error_message);
            },
            complete: function(xhr, status) {
              $("#result").show();
            }
          });

        });
      });
    </script>
{% seo %}
    {% include head-custom.html %}
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
      <a class="inner" href="/">
        <div class="content" role="img" aria-label="Detailed naturalistic pen drawing of a termite">
          <p class="header" id="project_title">{{ site.title | default: site.github.repository_name }}</p>
          <p class="header" id="project_tagline">{{ site.description | default: site.github.project_tagline }}</p>
        </div>
      </a>
    </div>

    <!-- NAVBAR -->
    <div id="navbar_wrap" class="outer">
      <nav class="inner">
        <ul>
          <li>
            <a href="/br-iban/" class="action">Brazil IBAN</a>
          </li>
          <li>
            <a href="/ca-routing-number/" class="action">Canada Routing Number</a>
          </li>
          <li>
            <a href="/mx-clabe/" class="action">Mexico CLABE</a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- MAIN CONTENT -->
    <h1 id="main_title">{{ page.title }}</h1>
    <section id="main_content" class="inner">
      {{ content }}
    </section>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        {% if site.github.is_project_page %}
        <p class="copyright">{{ site.title | default: site.github.repository_name }} maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a></p>
        {% endif %}
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
        <p>Questions? Email me at <a href="mailto:payment-field-engine@vigilandum.io">payment-field-engine@vigilandum.io</a></p>
      </footer>
    </div>
  </body>
</html>
